name: JFrog-GitHub Maven
on: workflow_dispatch
permissions:
  id-token: write
jobs:
  build:
    runs-on: buntu-22.04-arm
    name: Build Application
    container:
      image: elinaf.jfrog.io/jordanta-docker-local/jfrog-mvn-yoav-rt:latest
      credentials:
        username: ${{ secrets.JF_ACCESS_USER }}
        password: ${{ secrets.JF_ACCESS_TOKEN }}
      steps:
      - name: Install JFrog
        id: install-jf
        uses: jfrog/setup-jfrog-cli@v4.5.13
        env:
          JF_ACCESS_TOKEN: ${{ secrets.JF_ACCESS_TOKEN }}
      - name: Ping JFrog
        run: jf rt ping
      - name: Checkout
        id: checkout
        uses: actions/checkout@v3
      - name: JFrog Config Java Application
        id: config-jf
        run: |
          jf mvn-config --global --repo-resolve-releases jordanta-libs-release --repo-resolve-snapshots jordanta-libs-snapshot --repo-deploy-releases jordanta-libs-release --repo-deploy-snapshots jordanta-libs-snapshot
          whoami
          cat /root/.jfrog/projects/maven.yaml
          cat /root/.m2/settings.xml
      - name: Build Java Application
        id: run-jf
        run: |
          jf mvn clean install --batch-mode --errors --show-version --project $JF_PROJECT_KEY --threads 8 --build-name jf-mvn-test-build --build-number 1

